<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Tabla de usuarios con grado, grupo y turno -->
<div class="container mt-4">
  <h2 class="mb-3">Usuarios</h2>
  <a href="#" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#agregarUsuarioModal">
    Agregar Usuario
  </a>
  <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary mb-3">Volver al admin</a>

  <table class="table table-striped table-hover table-bordered align-middle">
    <thead class="table-dark text-center">
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Carrera</th>
        <th>Grado</th>
        <th>Grupo</th>
        <th>Turno</th>
        <th>Código</th>
        <th>Correo</th>
        <th>Teléfono</th>
        <th>Role</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for usuario in usuarios %}
      <tr class="text-center">
        <td>{{ usuario.id }}</td>
        <td>{{ usuario.nombre_completo }}</td>
        <td>{{ usuario.carrera }}</td>
        <td>{{ usuario.grado }}</td>
        <td>{{ usuario.grupo }}</td>
        <td>
          <span class="badge {% if usuario.turno == 'Matutino' %}bg-warning{% else %}bg-info{% endif %}">
            {{ usuario.turno }}
          </span>
        </td>
        <td>{{ usuario.codigo }}</td>
        <td>{{ usuario.correo }}</td>
        <td>{{ usuario.telefono }}</td>
        <td>
          <span class="badge {% if usuario.role == 'admin' %}bg-danger{% else %}bg-secondary{% endif %}">
            {{ usuario.role }}
          </span>
        </td>
        <td>
          <button class="btn btn-danger btn-sm" onclick="confirmDelete('{{ url_for('borrar_usuario', id=usuario.id) }}', '{{ usuario.nombre_completo }}')">
            Borrar
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
function confirmDelete(url, nombre) {
  Swal.fire({
    title: `¿Estás seguro de eliminar "${nombre}"?`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Sí, eliminar',
    cancelButtonText: 'No',
    reverseButtons: true
  }).then((result) => {
    if (result.isConfirmed) {
      // Crear un form dinámico
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = url;

      document.body.appendChild(form);
      form.submit();
    }
  });
}
</script>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Modal para agregar usuario -->
<div class="modal fade" id="agregarUsuarioModal" tabindex="-1" aria-labelledby="agregarUsuarioLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      
      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title" id="agregarUsuarioLabel">Registrar nuevo usuario</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <!-- Body con formulario -->
      <div class="modal-body">
        <form method="post" action="{{ url_for('agregar_usuario') }}">
          <div class="mb-3">
            <label for="nombre" class="form-label">Nombre completo</label>
            <input type="text" class="form-control" id="nombre" name="nombre" required />
          </div>

          <div class="mb-3">
            <label for="codigo" class="form-label">Código de estudiante</label>
            <input type="text" class="form-control" id="codigo" name="codigo" required />
          </div>

          <div class="mb-3">
            <label for="carrera" class="form-label">Carrera</label>
            <select class="form-select" id="carrera" name="carrera" required>
              <option value="" disabled selected>Selecciona tu carrera</option>
              <option value="Administración">Administración</option>
              <option value="Gestión aduanal">Gestión aduanal</option>
              <option value="Biotecnología">Biotecnología</option>
              <option value="Energías alternativas">Energías alternas</option>
              <option value="Telecomunicaciones">Telecomunicaciones</option>
              <option value="Informática">Informática</option>
              <option value="Procesos de manufactura competitiva">Procesos de manufactura competitiva</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="grado" class="form-label">Grado</label>
            <select class="form-select" id="grado" name="grado" required>
              <option value="" disabled selected>Selecciona tu grado</option>
              <option value="1">3(tercero)</option>
              <option value="2">4(cuarto)</option>
              <option value="3">5(quinto)</option>
              <option value="4">6(sexto)</option>
              <option value="5">7(septimo)</option>
              <option value="6">8(octavo)</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="grupo" class="form-label">Grupo</label>
            <select class="form-select" id="grupo" name="grupo" required>
              <option value="" disabled selected>Selecciona tu grupo</option>
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
            </select>
          </div>

          <!-- ✅ NUEVO CAMPO TURNO -->
          <div class="mb-3">
            <label for="turno" class="form-label">Turno</label>
            <select class="form-select" id="turno" name="turno" required>
              <option value="" disabled selected>Selecciona tu turno</option>
              <option value="Matutino">Matutino</option>
              <option value="Vespertino">Vespertino</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="correo" class="form-label">Correo electrónico</label>
            <input type="email" class="form-control" id="correo" name="correo" />
          </div>

          <div class="mb-3">
            <label for="telefono" class="form-label">Teléfono</label>
            <input type="tel" class="form-control" id="telefono" name="telefono" />
          </div>

          <div class="mb-3">
            <label for="password" class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="password" name="contrasena" required />
          </div>

          <!-- ✅ CAMPO ROLE (para admin) -->
          <div class="mb-3">
            <label for="role" class="form-label">Rol</label>
            <select class="form-select" id="role" name="role">
              <option value="user">Usuario normal</option>
              <option value="admin">Administrador</option>
            </select>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">Registrar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function confirmDelete(url, nombre) {
  Swal.fire({
    title: `¿Estás seguro de eliminar "${nombre}"?`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Sí, eliminar',
    cancelButtonText: 'No',
    reverseButtons: true
  }).then((result) => {
    if (result.isConfirmed) {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = url;
      document.body.appendChild(form);
      form.submit();
    }
  });
}
</script>